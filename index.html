<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Pro | Ø¬Ø²Ø¯Ø§Ù†ÛŒ Ø²ÛŒØ±Û•Ú©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;800&display=swap');
        body { font-family: 'Vazirmatn', sans-serif; background: #0f172a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-gradient { background: linear-gradient(90deg, #3b82f6, #8b5cf6); }
        .input-style { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 14px; border-radius: 15px; width: 100%; outline: none; color: white; }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">

    <div id="auth-container" class="w-full max-w-md mt-10 p-8 glass rounded-[2.5rem]">
        <h1 class="text-3xl font-black text-center mb-6 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">Wallet Pro</h1>
        <div class="flex gap-2 mb-6 bg-white/5 p-1 rounded-xl">
            <button onclick="toggleAuth('login')" class="flex-1 py-2 rounded-lg font-bold bg-blue-600" id="tab-login">Login</button>
            <button onclick="toggleAuth('signup')" class="flex-1 py-2 rounded-lg font-bold" id="tab-signup">Sign Up</button>
        </div>
        <div id="auth-fields" class="space-y-4">
            <input id="auth-email" type="email" placeholder="Ø¦ÛŒÙ…ÛÚµ" class="input-style">
            <input id="auth-password" type="password" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯" class="input-style">
            <div id="signup-only" class="hidden">
                <input id="auth-name" type="text" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ" class="input-style mt-4">
            </div>
            <button onclick="handleAuth()" class="w-full btn-gradient py-4 rounded-2xl font-bold mt-4 shadow-lg shadow-blue-500/20">Ø¨Û•Ø±Ø¯Û•ÙˆØ§Ù…Ø¨Û•</button>
            <button onclick="resetPassword()" class="text-xs text-gray-500 w-full text-center mt-4">Ù¾Ø§Ø³Û†Ø±Ø¯Ù… Ø¨ÛŒØ±Ú†ÙˆÙˆÛ•</button>
        </div>
    </div>

    <div id="main-ui" class="w-full max-w-md hidden">
        <div class="glass p-8 rounded-[2.5rem] mb-6 relative overflow-hidden shadow-2xl border border-white/10">
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-600/20 blur-[50px]"></div>
            <p id="user-welcome" class="text-gray-400 text-sm">Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª</p>
            <h1 id="balance-iqd" class="text-4xl font-black my-2">0 Ø¯.Ø¹</h1>
            <p id="balance-usd" class="text-green-400 text-xl font-medium opacity-90">$0.00</p>
            
            <div class="mt-8">
                <div class="flex justify-between text-[10px] mb-2 text-gray-400">
                    <span>Ø¦Ø§Ø³ØªÛŒ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª (10M)</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="w-full h-2 bg-gray-800 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-blue-500 to-purple-600 w-0 transition-all duration-1000"></div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <button onclick="openModal('income')" class="glass p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-green-500/10 transition">
                <span class="text-2xl">ğŸ’°</span> <span class="text-xs">Ø¯Ø§Ù‡Ø§Øª</span>
            </button>
            <button onclick="openModal('expense')" class="glass p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-red-500/10 transition">
                <span class="text-2xl">ğŸ›’</span> <span class="text-xs">Ù…Û•Ø³Ø±Û•Ù</span>
            </button>
            <button onclick="openModal('transfer')" class="glass p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-blue-500/10 transition col-span-2">
                <span class="text-2xl">ğŸ’¸</span> <span class="text-xs">Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û• (Ø¨Û• Ø¦Ø§ÛŒØ¯ÛŒ)</span>
            </button>
        </div>

        <div class="glass p-6 rounded-[2rem] mb-10">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold">Ø³Ø¬Ù„ÛŒ Ø®Û•Ø±Ø¬ÛŒÛŒÛ•Ú©Ø§Ù†</h3>
                <span id="my-id" onclick="copyID()" class="text-[9px] text-blue-400 cursor-pointer bg-blue-900/30 px-2 py-1 rounded-lg">ID Ú©Û†Ù¾ÛŒ Ø¨Ú©Û•</span>
            </div>
            <div id="history-list" class="space-y-4 max-h-80 overflow-y-auto">
                </div>
        </div>
        <button onclick="logout()" class="w-full text-red-500 text-sm mb-10">Ú†ÙˆÙˆÙ†Û•Ø¯Û•Û•Ø±Û•ÙˆÛ•</button>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/90 hidden items-center justify-center p-6 z-50">
        <div class="glass w-full max-w-sm p-8 rounded-[2.5rem] border border-white/20">
            <h2 id="modal-title" class="text-2xl font-bold mb-6 text-blue-400 text-center"></h2>
            <div id="modal-fields" class="space-y-4"></div>
            <div class="flex gap-3 mt-8">
                <button onclick="closeModal()" class="flex-1 text-gray-400">Ù¾Ø§Ø´Û•Ú©Ø´Û•</button>
                <button id="modal-confirm" class="flex-[2] btn-gradient py-3 rounded-xl font-bold">Ø¬ÛØ¨Û•Ø¬ÛÚ©Ø±Ø¯Ù†</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAMbSkztcgeeNgqpgvKf_VnB9Q4MQKomzk",
            authDomain: "hisabat-5b935.firebaseapp.com",
            databaseURL: "https://hisabat-5b935-default-rtdb.firebaseio.com",
            projectId: "hisabat-5b935",
            storageBucket: "hisabat-5b935.appspot.com",
            appId: "1:925180562302:android:7467c500ade5ab5900c12f"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const USD_RATE = 1520;
        let mode = 'login';

        function toggleAuth(m) {
            mode = m;
            document.getElementById('signup-only').classList.toggle('hidden', m !== 'signup');
            document.getElementById('tab-login').classList.toggle('bg-blue-600', m === 'login');
            document.getElementById('tab-signup').classList.toggle('bg-blue-600', m === 'signup');
        }

        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-password').value;
            const name = document.getElementById('auth-name').value;
            try {
                if (mode === 'signup') {
                    const res = await auth.createUserWithEmailAndPassword(email, pass);
                    await db.ref('users/' + res.user.uid).set({ name: name, balance: 0, email: email });
                } else {
                    await auth.signInWithEmailAndPassword(email, pass);
                }
            } catch (e) { alert(e.message); }
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('main-ui').classList.remove('hidden');
                document.getElementById('my-id').innerText = "ID: " + user.uid;
                loadData(user.uid);
            }
        });

        function loadData(uid) {
            db.ref('users/' + uid).on('value', snap => {
                const data = snap.val() || { balance: 0, name: 'Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±' };
                document.getElementById('user-welcome').innerText = "Ø¨Û•Ø®ÛØ±Ø¨ÛÛŒØª: " + (data.name || 'Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø±');
                const bal = data.balance || 0;
                document.getElementById('balance-iqd').innerText = bal.toLocaleString() + " Ø¯.Ø¹";
                document.getElementById('balance-usd').innerText = "$" + (bal / USD_RATE).toFixed(2);
                let prog = (bal / 10000000) * 100;
                document.getElementById('progress-bar').style.width = Math.min(prog, 100) + "%";
                document.getElementById('progress-text').innerText = Math.floor(Math.min(prog, 100)) + "%";
            });

            db.ref('users/' + uid + '/history').on('value', snap => {
                const list = document.getElementById('history-list');
                list.innerHTML = "";
                snap.forEach(child => {
                    const item = child.val();
                    list.innerHTML += `
                        <div class="flex justify-between items-center p-4 rounded-2xl bg-white/5 border-r-4 ${item.amount > 0 ? 'border-green-500' : 'border-red-500'}">
                            <div><p class="text-sm font-bold">${item.note}</p><p class="text-[10px] text-gray-500">${new Date(item.time).toLocaleString('ku-IQ')}</p></div>
                            <div class="text-right">
                                <p class="${item.amount > 0 ? 'text-green-400' : 'text-red-400'} font-bold">${item.amount.toLocaleString()}</p>
                                <button onclick="deleteTx('${child.key}', ${item.amount})" class="text-[10px] text-gray-600 hover:text-red-400">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button>
                            </div>
                        </div>`;
                });
            });
        }

        async function processTransaction(type, amount, note, targetId = null) {
            const uid = auth.currentUser.uid;
            if (type === 'transfer') {
                await db.ref('users/' + targetId + '/balance').transaction(b => (b || 0) + amount);
                await db.ref('users/' + targetId + '/history').push({ note: "Ù¾Ø§Ø±Û• Ù‡Ø§Øª Ù„Û•Ù„Ø§ÛŒÛ•Ù† Ù‡Ø§ÙˆÚ•Û", amount: amount, time: Date.now() });
                await db.ref('users/' + uid + '/balance').transaction(b => (b || 0) - amount);
                await db.ref('users/' + uid + '/history').push({ note: "Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û•", amount: -amount, time: Date.now() });
            } else {
                const finalAmount = type === 'expense' ? -amount : amount;
                await db.ref('users/' + uid + '/balance').transaction(b => (b || 0) + finalAmount);
                await db.ref('users/' + uid + '/history').push({ note: note, amount: finalAmount, time: Date.now() });
            }
            closeModal();
        }

        function deleteTx(key, amount) {
            if (confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒ Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ")) {
                db.ref('users/' + auth.currentUser.uid + '/history/' + key).remove();
                db.ref('users/' + auth.currentUser.uid + '/balance').transaction(b => (b || 0) - amount);
            }
        }

        function openModal(mode) {
            document.getElementById('modal').style.display = 'flex';
            const fields = document.getElementById('modal-fields');
            const btn = document.getElementById('modal-confirm');
            if (mode === 'transfer') {
                document.getElementById('modal-title').innerText = "Ù†Ø§Ø±Ø¯Ù†ÛŒ Ù¾Ø§Ø±Û•";
                fields.innerHTML = `<input id="v-id" placeholder="ID ÙˆÛ•Ø±Ú¯Ø±" class="input-style"><input id="v-amount" type="number" placeholder="Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•" class="input-style">`;
                btn.onclick = () => processTransaction('transfer', parseInt(document.getElementById('v-amount').value), '', document.getElementById('v-id').value);
            } else {
                document.getElementById('modal-title').innerText = mode === 'income' ? "Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¯Ø§Ù‡Ø§Øª" : "ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ø®Û•Ø±Ø¬ÛŒ";
                fields.innerHTML = `<input id="v-note" placeholder="Ú†ÛŒ Ø¨ÙˆÙˆØŸ" class="input-style"><input id="v-amount" type="number" placeholder="Ø¨Ú•ÛŒ Ù¾Ø§Ø±Û•" class="input-style">`;
                btn.onclick = () => processTransaction(mode, parseInt(document.getElementById('v-amount').value), document.getElementById('v-note').value);
            }
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        function logout() { auth.signOut().then(() => location.reload()); }
        function copyID() { navigator.clipboard.writeText(auth.currentUser.uid); alert("ID Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§!"); }
        function resetPassword() {
            const email = document.getElementById('auth-email').value;
            if (email) auth.sendPasswordResetEmail(email).then(() => alert("Ù„ÛŒÙ†Ú©ÛŒ Ù¾Ø§Ø³Û†Ø±Ø¯ Ø¨Û† Ø¦ÛŒÙ…ÛÚµÛ•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§"));
            else alert("Ø¦ÛŒÙ…ÛÚµÛ•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•");
        }
    </script>
</body>
</html>
